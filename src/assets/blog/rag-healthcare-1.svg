<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#8b5cf6" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="800" fill="#0f172a"/>

  <!-- Title -->
  <text x="600" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    RAG Architecture for Healthcare
  </text>

  <!-- VPC Container -->
  <rect x="100" y="100" width="700" height="600" fill="none" stroke="#10b981" stroke-width="3" stroke-dasharray="10,5" rx="10"/>
  <text x="110" y="90" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#10b981">
    SECURE VPC
  </text>

  <!-- User Query Input -->
  <rect x="50" y="140" width="180" height="80" fill="#1e293b" stroke="#8b5cf6" stroke-width="2" rx="8"/>
  <text x="140" y="175" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    User Query Input
  </text>
  <text x="140" y="195" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    "What is the protocol"
  </text>
  <text x="140" y="210" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    "for sepsis?"
  </text>

  <!-- Auth & Authorization Gate -->
  <rect x="270" y="140" width="180" height="80" fill="#1e293b" stroke="#ec4899" stroke-width="2" rx="8"/>
  <text x="360" y="170" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Authentication &amp;
  </text>
  <text x="360" y="190" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Authorization
  </text>
  <text x="360" y="210" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    RBAC Check
  </text>

  <!-- Vector Database -->
  <rect x="130" y="280" width="180" height="100" fill="#1e293b" stroke="#3b82f6" stroke-width="2" rx="8"/>
  <text x="220" y="310" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Vector Database
  </text>
  <text x="220" y="330" font-family="Arial, sans-serif" font-size="12" fill="#3b82f6" text-anchor="middle">
    (pgvector)
  </text>
  <text x="220" y="350" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    Embedded medical
  </text>
  <text x="220" y="365" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    documents &amp; protocols
  </text>

  <!-- Retrieval Layer -->
  <rect x="350" y="280" width="180" height="100" fill="#1e293b" stroke="#10b981" stroke-width="2" rx="8"/>
  <text x="440" y="310" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Retrieval Layer
  </text>
  <text x="440" y="335" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    Hybrid Search:
  </text>
  <text x="440" y="350" font-family="Arial, sans-serif" font-size="11" fill="#10b981" text-anchor="middle">
    Vector (semantic) +
  </text>
  <text x="440" y="365" font-family="Arial, sans-serif" font-size="11" fill="#10b981" text-anchor="middle">
    Keyword (exact match)
  </text>

  <!-- De-identification Layer -->
  <rect x="570" y="280" width="180" height="100" fill="#1e293b" stroke="#f59e0b" stroke-width="2" rx="8"/>
  <text x="660" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    De-identification
  </text>
  <text x="660" y="325" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Layer
  </text>
  <text x="660" y="345" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    Removes PHI:
  </text>
  <text x="660" y="360" font-family="Arial, sans-serif" font-size="10" fill="#f59e0b" text-anchor="middle">
    Names, MRNs, Dates
  </text>
  <text x="660" y="373" font-family="Arial, sans-serif" font-size="10" fill="#10b981" text-anchor="middle">
    → Generic tokens
  </text>

  <!-- LLM API Layer -->
  <rect x="850" y="140" width="180" height="80" fill="#1e293b" stroke="#8b5cf6" stroke-width="2" rx="8"/>
  <text x="940" y="165" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    LLM API Layer
  </text>
  <text x="940" y="185" font-family="Arial, sans-serif" font-size="12" fill="#8b5cf6" text-anchor="middle">
    OpenAI / Anthropic
  </text>
  <text x="940" y="205" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    (with BAA)
  </text>

  <!-- External Label -->
  <text x="950" y="90" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#ec4899">
    EXTERNAL API
  </text>

  <!-- Response Generation -->
  <rect x="850" y="280" width="180" height="100" fill="#1e293b" stroke="#10b981" stroke-width="2" rx="8"/>
  <text x="940" y="305" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Response
  </text>
  <text x="940" y="325" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Generation
  </text>
  <text x="940" y="345" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    With source citations
  </text>
  <text x="940" y="360" font-family="Arial, sans-serif" font-size="11" fill="#10b981" text-anchor="middle">
    &amp; verification links
  </text>

  <!-- Audit Logging -->
  <rect x="240" y="450" width="400" height="80" fill="#1e293b" stroke="#ec4899" stroke-width="2" rx="8"/>
  <text x="440" y="480" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Audit Logging
  </text>
  <text x="440" y="500" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    Captures: User ID • Timestamp • Query • Retrieved Docs • Response
  </text>
  <text x="440" y="518" font-family="Arial, sans-serif" font-size="11" fill="#ec4899" text-anchor="middle">
    HIPAA &amp; SOC2 Compliance Required
  </text>

  <!-- User Response -->
  <rect x="850" y="580" width="180" height="80" fill="#1e293b" stroke="#10b981" stroke-width="2" rx="8"/>
  <text x="940" y="610" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e2e8f0" text-anchor="middle">
    Secure Response
  </text>
  <text x="940" y="630" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">
    Answer + Citations
  </text>
  <text x="940" y="648" font-family="Arial, sans-serif" font-size="11" fill="#10b981" text-anchor="middle">
    Verified &amp; Logged
  </text>

  <!-- Arrows -->
  <!-- Query to Auth -->
  <line x1="230" y1="180" x2="270" y2="180" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Auth to Retrieval -->
  <line x1="360" y1="220" x2="360" y2="260" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="360" y1="260" x2="440" y2="260" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="440" y1="260" x2="440" y2="280" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Vector DB to Retrieval -->
  <line x1="310" y1="330" x2="350" y2="330" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Retrieval to De-ID -->
  <line x1="530" y1="330" x2="570" y2="330" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- De-ID to LLM -->
  <line x1="750" y1="330" x2="800" y2="330" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="800" y1="330" x2="800" y2="180" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="800" y1="180" x2="850" y2="180" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- LLM to Response -->
  <line x1="940" y1="220" x2="940" y2="280" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Response to Audit -->
  <line x1="850" y1="330" x2="680" y2="330" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="680" y1="330" x2="680" y2="430" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="680" y1="430" x2="640" y2="430" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="640" y1="430" x2="440" y2="430" stroke="#8b5cf6" stroke-width="2"/>
  <line x1="440" y1="430" x2="440" y2="450" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Response to User -->
  <line x1="940" y1="380" x2="940" y2="580" stroke="#10b981" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Legend -->
  <rect x="50" y="720" width="1100" height="60" fill="#1e293b" stroke="#475569" stroke-width="1" rx="8"/>
  <text x="60" y="740" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e2e8f0">
    Key:
  </text>
  <line x1="110" y1="735" x2="150" y2="735" stroke="#10b981" stroke-width="3" stroke-dasharray="10,5"/>
  <text x="160" y="740" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8">
    Secure VPC Boundary
  </text>
  <circle cx="320" cy="735" r="8" fill="#8b5cf6"/>
  <text x="335" y="740" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8">
    Data Flow
  </text>
  <circle cx="460" cy="735" r="8" fill="#ec4899"/>
  <text x="475" y="740" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8">
    Security Checkpoints
  </text>
  <circle cx="650" cy="735" r="8" fill="#3b82f6"/>
  <text x="665" y="740" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8">
    Storage Layer
  </text>
  <circle cx="820" cy="735" r="8" fill="#f59e0b"/>
  <text x="835" y="740" font-family="Arial, sans-serif" font-size="11" fill="#94a3b8">
    PHI Protection
  </text>

  <text x="60" y="765" font-family="Arial, sans-serif" font-size="10" fill="#64748b" font-style="italic">
    All patient data remains within VPC • Only de-identified context sent to external LLM • Every interaction logged for audit
  </text>
</svg>