<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700">
  <defs>
    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:0.2" />
      <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.2" />
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1000" height="700" fill="#0f172a"/>

  <!-- Title -->
  <text x="500" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#e2e8f0" text-anchor="middle">Secure Lambda Configuration</text>

  <!-- Security Boundary -->
  <rect x="50" y="80" width="900" height="550" rx="10" fill="url(#grad1)" stroke="#ec4899" stroke-width="3" stroke-dasharray="10,5"/>
  <text x="70" y="105" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ec4899">Security Boundary</text>

  <!-- VPC Container -->
  <rect x="100" y="130" width="800" height="450" rx="8" fill="none" stroke="#475569" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="120" y="155" font-family="Arial, sans-serif" font-size="13" fill="#94a3b8">VPC</text>

  <!-- Private Subnet -->
  <rect x="130" y="170" width="740" height="380" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="2"/>
  <text x="150" y="195" font-family="Arial, sans-serif" font-size="12" fill="#8b5cf6">Private Subnet</text>

  <!-- Central Lambda Function -->
  <rect x="350" y="240" width="300" height="250" rx="8" fill="#8b5cf6" filter="url(#glow)"/>
  <text x="500" y="270" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff" text-anchor="middle">Lambda Function</text>
  <text x="500" y="295" font-family="Arial, sans-serif" font-size="11" fill="#e2e8f0" text-anchor="middle">Processes PHI in VPC Private Subnet</text>

  <!-- Lambda Details -->
  <rect x="370" y="315" width="260" height="155" rx="5" fill="#1e293b"/>

  <text x="385" y="335" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#10b981">Runtime Configuration:</text>
  <text x="395" y="355" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• VPC-enabled (private subnet)</text>
  <text x="395" y="372" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• Security group attached</text>
  <text x="395" y="389" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• IAM execution role</text>
  <text x="395" y="406" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• Environment encryption</text>

  <text x="385" y="430" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#3b82f6">Monitoring:</text>
  <text x="395" y="448" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• X-Ray tracing enabled</text>
  <text x="395" y="463" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">• CloudWatch Logs encryption</text>

  <!-- Security Group -->
  <rect x="150" y="300" width="170" height="120" rx="5" fill="#334155" stroke="#10b981" stroke-width="2"/>
  <text x="235" y="325" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#10b981" text-anchor="middle">Security Group</text>

  <text x="165" y="350" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Inbound:</text>
  <text x="175" y="367" font-family="Arial, sans-serif" font-size="9" fill="#94a3b8">• None (invoked async)</text>

  <text x="165" y="390" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Outbound:</text>
  <text x="175" y="407" font-family="Arial, sans-serif" font-size="9" fill="#10b981">• DynamoDB endpoint</text>

  <!-- DynamoDB VPC Endpoint -->
  <rect x="680" y="300" width="160" height="100" rx="5" fill="#334155" stroke="#10b981" stroke-width="2"/>
  <text x="760" y="325" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#10b981" text-anchor="middle">DynamoDB</text>
  <text x="760" y="342" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#10b981" text-anchor="middle">VPC Endpoint</text>
  <text x="760" y="365" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">Private connection to</text>
  <text x="760" y="380" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">DynamoDB service</text>
  <text x="760" y="395" font-family="Arial, sans-serif" font-size="9" fill="#94a3b8" text-anchor="middle">(no internet traffic)</text>

  <!-- IAM Role (outside VPC) -->
  <rect x="150" y="100" width="180" height="160" rx="5" fill="#ec4899" filter="url(#glow)"/>
  <text x="240" y="125" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">IAM Execution Role</text>
  <text x="240" y="145" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0" text-anchor="middle">Least Privilege Policies</text>

  <rect x="165" y="160" width="150" height="85" rx="3" fill="#1e293b"/>
  <text x="175" y="178" font-family="Arial, sans-serif" font-size="9" fill="#10b981">Allowed Actions:</text>
  <text x="180" y="193" font-family="Arial, sans-serif" font-size="8" fill="#e2e8f0">• dynamodb:PutItem</text>
  <text x="180" y="206" font-family="Arial, sans-serif" font-size="8" fill="#e2e8f0">• dynamodb:GetItem</text>
  <text x="180" y="219" font-family="Arial, sans-serif" font-size="8" fill="#e2e8f0">• dynamodb:Query</text>
  <text x="180" y="232" font-family="Arial, sans-serif" font-size="8" fill="#ec4899">• On specific PHI table only</text>

  <!-- Secrets Manager (outside VPC) -->
  <rect x="700" y="100" width="180" height="110" rx="5" fill="#3b82f6" filter="url(#glow)"/>
  <text x="790" y="125" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">Secrets Manager</text>

  <rect x="715" y="140" width="150" height="60" rx="3" fill="#1e293b"/>
  <text x="790" y="158" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">Stores:</text>
  <text x="725" y="175" font-family="Arial, sans-serif" font-size="8" fill="#10b981">• DB credentials</text>
  <text x="725" y="188" font-family="Arial, sans-serif" font-size="8" fill="#10b981">• API keys</text>
  <text x="785" y="175" font-family="Arial, sans-serif" font-size="8" fill="#ec4899">• Auto-rotation</text>
  <text x="785" y="188" font-family="Arial, sans-serif" font-size="8" fill="#ec4899">• Encrypted</text>

  <!-- KMS (outside VPC) -->
  <rect x="450" y="100" width="140" height="90" rx="5" fill="#10b981" filter="url(#glow)"/>
  <text x="520" y="125" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#fff" text-anchor="middle">KMS Key</text>
  <text x="520" y="145" font-family="Arial, sans-serif" font-size="10" fill="#1e293b" text-anchor="middle">Customer Managed</text>

  <rect x="465" y="158" width="110" height="25" rx="3" fill="#1e293b"/>
  <text x="520" y="175" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">Encrypts env vars</text>

  <!-- CloudWatch Logs (outside VPC, bottom) -->
  <rect x="150" y="450" width="160" height="90" rx="5" fill="#3b82f6"/>
  <text x="230" y="475" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">CloudWatch Logs</text>

  <rect x="165" y="490" width="130" height="40" rx="3" fill="#1e293b"/>
  <text x="230" y="507" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">• Encrypted at rest</text>
  <text x="230" y="522" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">• Extended retention</text>

  <!-- X-Ray (outside VPC, bottom) -->
  <rect x="680" y="450" width="160" height="90" rx="5" fill="#ec4899"/>
  <text x="760" y="475" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#fff" text-anchor="middle">X-Ray Tracing</text>

  <rect x="695" y="490" width="130" height="40" rx="3" fill="#1e293b"/>
  <text x="760" y="507" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">• Trace all requests</text>
  <text x="760" y="522" font-family="Arial, sans-serif" font-size="9" fill="#e2e8f0" text-anchor="middle">• Track PHI access</text>

  <!-- Arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#94a3b8" />
    </marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#10b981" />
    </marker>
  </defs>

  <!-- IAM Role to Lambda -->
  <line x1="240" y1="260" x2="420" y2="240" stroke="#ec4899" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead)"/>
  <text x="310" y="245" font-family="Arial, sans-serif" font-size="9" fill="#ec4899">Assumes role</text>

  <!-- Secrets Manager to Lambda -->
  <line x1="720" y1="210" x2="580" y2="240" stroke="#3b82f6" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead)"/>
  <text x="630" y="220" font-family="Arial, sans-serif" font-size="9" fill="#3b82f6">Retrieves secrets</text>

  <!-- KMS to Lambda -->
  <line x1="520" y1="190" x2="500" y2="240" stroke="#10b981" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrowhead)"/>
  <text x="495" y="210" font-family="Arial, sans-serif" font-size="9" fill="#10b981">Decrypts</text>

  <!-- Lambda to DynamoDB Endpoint -->
  <line x1="650" y1="350" x2="680" y2="350" stroke="#10b981" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="652" y="342" font-family="Arial, sans-serif" font-size="9" fill="#10b981">Query/Write</text>

  <!-- Security Group to DynamoDB -->
  <line x1="320" y1="360" x2="350" y2="360" stroke="#94a3b8" stroke-width="2" stroke-dasharray="3,2" marker-end="url(#arrowhead)"/>
  <text x="322" y="352" font-family="Arial, sans-serif" font-size="8" fill="#94a3b8">Allows outbound</text>

  <!-- Lambda to CloudWatch -->
  <line x1="430" y1="490" x2="310" y2="490" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="355" y="482" font-family="Arial, sans-serif" font-size="9" fill="#3b82f6">Logs</text>

  <!-- Lambda to X-Ray -->
  <line x1="570" y1="490" x2="680" y2="490" stroke="#ec4899" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="590" y="482" font-family="Arial, sans-serif" font-size="9" fill="#ec4899">Traces</text>

  <!-- Legend -->
  <text x="50" y="665" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e2e8f0">Security Layers:</text>

  <rect x="200" y="653" width="12" height="12" fill="#ec4899"/>
  <text x="220" y="663" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Identity &amp; Access</text>

  <rect x="350" y="653" width="12" height="12" fill="#10b981"/>
  <text x="370" y="663" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Network &amp; Encryption</text>

  <rect x="530" y="653" width="12" height="12" fill="#3b82f6"/>
  <text x="550" y="663" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Monitoring &amp; Logging</text>

  <rect x="710" y="653" width="12" height="12" fill="#8b5cf6"/>
  <text x="730" y="663" font-family="Arial, sans-serif" font-size="10" fill="#e2e8f0">Compute</text>
</svg>