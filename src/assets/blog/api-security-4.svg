<svg viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg">
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowGray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#64748b"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#8b5cf6"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#10b981"/>
    </marker>
    <marker id="arrowPink" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ec4899"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f59e0b"/>
    </marker>
    <marker id="arrowCyan" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#06b6d4"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- Dark background -->
  <rect width="1400" height="1000" fill="#0f172a"/>

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" fill="#f1f5f9" font-size="24" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">API Data Protection Layers</text>
  <text x="700" y="65" text-anchor="middle" fill="#94a3b8" font-size="14" font-family="system-ui, -apple-system, sans-serif">Comprehensive Healthcare Data Protection Strategy</text>

  <!-- Layer 1: Client Layer -->
  <g id="client-layer">
    <rect x="50" y="100" width="1300" height="110" rx="8" fill="#1e293b" stroke="#3b82f6" stroke-width="3"/>
    <text x="700" y="130" text-anchor="middle" fill="#3b82f6" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 1: Client Layer</text>

    <rect x="80" y="145" width="200" height="50" rx="6" fill="#1e3a8a" stroke="#3b82f6" stroke-width="2"/>
    <text x="180" y="165" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">TLS 1.3 Encryption</text>
    <text x="180" y="182" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">All traffic encrypted</text>

    <rect x="300" y="145" width="200" height="50" rx="6" fill="#1e3a8a" stroke="#3b82f6" stroke-width="2"/>
    <text x="400" y="165" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Certificate Pinning</text>
    <text x="400" y="182" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Mobile apps: MITM prevention</text>

    <rect x="520" y="145" width="200" height="50" rx="6" fill="#1e3a8a" stroke="#3b82f6" stroke-width="2"/>
    <text x="620" y="165" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Request Signing</text>
    <text x="620" y="182" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">JWT signatures validated</text>

    <rect x="740" y="145" width="200" height="50" rx="6" fill="#1e3a8a" stroke="#3b82f6" stroke-width="2"/>
    <text x="840" y="165" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Input Sanitization</text>
    <text x="840" y="182" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Client-side validation</text>

    <rect x="960" y="145" width="200" height="50" rx="6" fill="#1e3a8a" stroke="#3b82f6" stroke-width="2"/>
    <text x="1060" y="165" text-anchor="middle" fill="#93c5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Secure Storage</text>
    <text x="1060" y="182" text-anchor="middle" fill="#93c5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Tokens in secure keychain</text>
  </g>

  <path d="M 700 220 L 700 240" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Layer 2: API Gateway -->
  <g id="gateway-layer">
    <rect x="50" y="250" width="1300" height="110" rx="8" fill="#1e293b" stroke="#8b5cf6" stroke-width="3"/>
    <text x="700" y="280" text-anchor="middle" fill="#8b5cf6" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 2: API Gateway</text>

    <rect x="80" y="295" width="200" height="50" rx="6" fill="#581c87" stroke="#8b5cf6" stroke-width="2"/>
    <text x="180" y="315" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Request Filtering</text>
    <text x="180" y="332" text-anchor="middle" fill="#c4b5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Schema validation, size limits</text>

    <rect x="300" y="295" width="200" height="50" rx="6" fill="#581c87" stroke="#8b5cf6" stroke-width="2"/>
    <text x="400" y="315" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">WAF Rules</text>
    <text x="400" y="332" text-anchor="middle" fill="#c4b5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">SQL injection, XSS blocking</text>

    <rect x="520" y="295" width="200" height="50" rx="6" fill="#581c87" stroke="#8b5cf6" stroke-width="2"/>
    <text x="620" y="315" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Rate Limiting</text>
    <text x="620" y="332" text-anchor="middle" fill="#c4b5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Prevent data exfiltration</text>

    <rect x="740" y="295" width="200" height="50" rx="6" fill="#581c87" stroke="#8b5cf6" stroke-width="2"/>
    <text x="840" y="315" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Response Sanitization</text>
    <text x="840" y="332" text-anchor="middle" fill="#c4b5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">Remove stack traces, PHI</text>

    <rect x="960" y="295" width="200" height="50" rx="6" fill="#581c87" stroke="#8b5cf6" stroke-width="2"/>
    <text x="1060" y="315" text-anchor="middle" fill="#c4b5fd" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">DDoS Protection</text>
    <text x="1060" y="332" text-anchor="middle" fill="#c4b5fd" font-size="10" font-family="system-ui, -apple-system, sans-serif">CloudFlare, AWS Shield</text>
  </g>

  <path d="M 700 370 L 700 390" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Layer 3: Application Layer -->
  <g id="app-layer">
    <rect x="50" y="400" width="1300" height="110" rx="8" fill="#1e293b" stroke="#10b981" stroke-width="3"/>
    <text x="700" y="430" text-anchor="middle" fill="#10b981" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 3: Application Layer</text>

    <rect x="80" y="445" width="200" height="50" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
    <text x="180" y="465" text-anchor="middle" fill="#6ee7b7" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">PHI Identification</text>
    <text x="180" y="482" text-anchor="middle" fill="#6ee7b7" font-size="10" font-family="system-ui, -apple-system, sans-serif">Detect sensitive fields</text>

    <rect x="300" y="445" width="200" height="50" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
    <text x="400" y="465" text-anchor="middle" fill="#6ee7b7" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Field Masking</text>
    <text x="400" y="482" text-anchor="middle" fill="#6ee7b7" font-size="10" font-family="system-ui, -apple-system, sans-serif">SSN: ***-**-1234</text>

    <rect x="520" y="445" width="200" height="50" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
    <text x="620" y="465" text-anchor="middle" fill="#6ee7b7" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Access Control</text>
    <text x="620" y="482" text-anchor="middle" fill="#6ee7b7" font-size="10" font-family="system-ui, -apple-system, sans-serif">Patient-level authorization</text>

    <rect x="740" y="445" width="200" height="50" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
    <text x="840" y="465" text-anchor="middle" fill="#6ee7b7" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Error Handling</text>
    <text x="840" y="482" text-anchor="middle" fill="#6ee7b7" font-size="10" font-family="system-ui, -apple-system, sans-serif">Generic errors, no PHI</text>

    <rect x="960" y="445" width="200" height="50" rx="6" fill="#064e3b" stroke="#10b981" stroke-width="2"/>
    <text x="1060" y="465" text-anchor="middle" fill="#6ee7b7" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Business Logic</text>
    <text x="1060" y="482" text-anchor="middle" fill="#6ee7b7" font-size="10" font-family="system-ui, -apple-system, sans-serif">FHIR resource handling</text>
  </g>

  <path d="M 700 520 L 700 540" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Layer 4: Data Access Layer -->
  <g id="data-access-layer">
    <rect x="50" y="550" width="1300" height="110" rx="8" fill="#1e293b" stroke="#ec4899" stroke-width="3"/>
    <text x="700" y="580" text-anchor="middle" fill="#ec4899" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 4: Data Access Layer</text>

    <rect x="80" y="595" width="200" height="50" rx="6" fill="#831843" stroke="#ec4899" stroke-width="2"/>
    <text x="180" y="615" text-anchor="middle" fill="#f9a8d4" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Query Filters</text>
    <text x="180" y="632" text-anchor="middle" fill="#f9a8d4" font-size="10" font-family="system-ui, -apple-system, sans-serif">WHERE patient_id IN (...)</text>

    <rect x="300" y="595" width="200" height="50" rx="6" fill="#831843" stroke="#ec4899" stroke-width="2"/>
    <text x="400" y="615" text-anchor="middle" fill="#f9a8d4" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Row-Level Security</text>
    <text x="400" y="632" text-anchor="middle" fill="#f9a8d4" font-size="10" font-family="system-ui, -apple-system, sans-serif">PostgreSQL RLS policies</text>

    <rect x="520" y="595" width="200" height="50" rx="6" fill="#831843" stroke="#ec4899" stroke-width="2"/>
    <text x="620" y="615" text-anchor="middle" fill="#f9a8d4" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Parameterized Queries</text>
    <text x="620" y="632" text-anchor="middle" fill="#f9a8d4" font-size="10" font-family="system-ui, -apple-system, sans-serif">SQL injection prevention</text>

    <rect x="740" y="595" width="200" height="50" rx="6" fill="#831843" stroke="#ec4899" stroke-width="2"/>
    <text x="840" y="615" text-anchor="middle" fill="#f9a8d4" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">ORM Security</text>
    <text x="840" y="632" text-anchor="middle" fill="#f9a8d4" font-size="10" font-family="system-ui, -apple-system, sans-serif">Safe query builders</text>

    <rect x="960" y="595" width="200" height="50" rx="6" fill="#831843" stroke="#ec4899" stroke-width="2"/>
    <text x="1060" y="615" text-anchor="middle" fill="#f9a8d4" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Connection Security</text>
    <text x="1060" y="632" text-anchor="middle" fill="#f9a8d4" font-size="10" font-family="system-ui, -apple-system, sans-serif">TLS to database</text>
  </g>

  <path d="M 700 670 L 700 690" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Layer 5: Database Layer -->
  <g id="database-layer">
    <rect x="50" y="700" width="1300" height="110" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="3"/>
    <text x="700" y="730" text-anchor="middle" fill="#f59e0b" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 5: Database Layer</text>

    <rect x="80" y="745" width="200" height="50" rx="6" fill="#422006" stroke="#f59e0b" stroke-width="2"/>
    <text x="180" y="765" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Encryption at Rest</text>
    <text x="180" y="782" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">AES-256 disk encryption</text>

    <rect x="300" y="745" width="200" height="50" rx="6" fill="#422006" stroke="#f59e0b" stroke-width="2"/>
    <text x="400" y="765" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Field-Level Encryption</text>
    <text x="400" y="782" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">SSN, MRN encrypted</text>

    <rect x="520" y="745" width="200" height="50" rx="6" fill="#422006" stroke="#f59e0b" stroke-width="2"/>
    <text x="620" y="765" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">KMS Integration</text>
    <text x="620" y="782" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">AWS KMS key management</text>

    <rect x="740" y="745" width="200" height="50" rx="6" fill="#422006" stroke="#f59e0b" stroke-width="2"/>
    <text x="840" y="765" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Key Rotation</text>
    <text x="840" y="782" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">Quarterly rotation policy</text>

    <rect x="960" y="745" width="200" height="50" rx="6" fill="#422006" stroke="#f59e0b" stroke-width="2"/>
    <text x="1060" y="765" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Backup Encryption</text>
    <text x="1060" y="782" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">Encrypted backups</text>
  </g>

  <path d="M 700 820 L 700 840" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Layer 6: Audit Layer -->
  <g id="audit-layer">
    <rect x="50" y="850" width="1300" height="110" rx="8" fill="#1e293b" stroke="#06b6d4" stroke-width="3"/>
    <text x="700" y="880" text-anchor="middle" fill="#06b6d4" font-size="16" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Layer 6: Audit &amp; Monitoring Layer</text>

    <rect x="80" y="895" width="240" height="50" rx="6" fill="#164e63" stroke="#06b6d4" stroke-width="2"/>
    <text x="200" y="915" text-anchor="middle" fill="#a5f3fc" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Immutable Audit Logs</text>
    <text x="200" y="932" text-anchor="middle" fill="#a5f3fc" font-size="10" font-family="system-ui, -apple-system, sans-serif">All data access logged</text>

    <rect x="340" y="895" width="240" height="50" rx="6" fill="#164e63" stroke="#06b6d4" stroke-width="2"/>
    <text x="460" y="915" text-anchor="middle" fill="#a5f3fc" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">SIEM Integration</text>
    <text x="460" y="932" text-anchor="middle" fill="#a5f3fc" font-size="10" font-family="system-ui, -apple-system, sans-serif">Splunk, Datadog, CloudWatch</text>

    <rect x="600" y="895" width="240" height="50" rx="6" fill="#164e63" stroke="#06b6d4" stroke-width="2"/>
    <text x="720" y="915" text-anchor="middle" fill="#a5f3fc" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Anomaly Detection</text>
    <text x="720" y="932" text-anchor="middle" fill="#a5f3fc" font-size="10" font-family="system-ui, -apple-system, sans-serif">ML-based threat detection</text>

    <rect x="860" y="895" width="240" height="50" rx="6" fill="#164e63" stroke="#06b6d4" stroke-width="2"/>
    <text x="980" y="915" text-anchor="middle" fill="#a5f3fc" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">HIPAA Compliance</text>
    <text x="980" y="932" text-anchor="middle" fill="#a5f3fc" font-size="10" font-family="system-ui, -apple-system, sans-serif">6-year retention, tamper-proof</text>

    <rect x="1120" y="895" width="210" height="50" rx="6" fill="#164e63" stroke="#06b6d4" stroke-width="2"/>
    <text x="1225" y="915" text-anchor="middle" fill="#a5f3fc" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Real-time Alerts</text>
    <text x="1225" y="932" text-anchor="middle" fill="#a5f3fc" font-size="10" font-family="system-ui, -apple-system, sans-serif">Security incidents</text>
  </g>

  <!-- Data Flow Examples -->
  <g id="flow-examples" transform="translate(0, -880)">
    <!-- Read Request Flow -->
    <text x="50" y="900" fill="#94a3b8" font-size="13" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Read Request Flow:</text>
    <line x1="50" y1="915" x2="100" y2="915" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrowBlue)"/>
    <text x="110" y="920" fill="#3b82f6" font-size="11" font-family="system-ui, -apple-system, sans-serif">1. TLS encrypted request</text>
    <line x1="250" y1="915" x2="300" y2="915" stroke="#8b5cf6" stroke-width="3" marker-end="url(#arrowPurple)"/>
    <text x="310" y="920" fill="#8b5cf6" font-size="11" font-family="system-ui, -apple-system, sans-serif">2. Gateway filters/validates</text>
    <line x1="470" y1="915" x2="520" y2="915" stroke="#10b981" stroke-width="3" marker-end="url(#arrowGreen)"/>
    <text x="530" y="920" fill="#10b981" font-size="11" font-family="system-ui, -apple-system, sans-serif">3. App checks authorization</text>

    <line x1="50" y1="940" x2="100" y2="940" stroke="#ec4899" stroke-width="3" marker-end="url(#arrowPink)"/>
    <text x="110" y="945" fill="#ec4899" font-size="11" font-family="system-ui, -apple-system, sans-serif">4. Query with patient filter</text>
    <line x1="280" y1="940" x2="330" y2="940" stroke="#f59e0b" stroke-width="3" marker-end="url(#arrowOrange)"/>
    <text x="340" y="945" fill="#f59e0b" font-size="11" font-family="system-ui, -apple-system, sans-serif">5. Decrypt sensitive fields</text>
    <line x1="500" y1="940" x2="550" y2="940" stroke="#06b6d4" stroke-width="3" marker-end="url(#arrowCyan)"/>
    <text x="560" y="945" fill="#06b6d4" font-size="11" font-family="system-ui, -apple-system, sans-serif">6. Log access to audit trail</text>

    <!-- Write Request Flow -->
    <text x="50" y="975" fill="#94a3b8" font-size="13" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Write Request Flow:</text>
    <line x1="50" y1="990" x2="100" y2="990" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrowBlue)"/>
    <text x="110" y="995" fill="#3b82f6" font-size="11" font-family="system-ui, -apple-system, sans-serif">1. Client validates + signs</text>
    <line x1="250" y1="990" x2="300" y2="990" stroke="#8b5cf6" stroke-width="3" marker-end="url(#arrowPurple)"/>
    <text x="310" y="995" fill="#8b5cf6" font-size="11" font-family="system-ui, -apple-system, sans-serif">2. WAF checks for injection</text>
    <line x1="470" y1="990" x2="520" y2="990" stroke="#10b981" stroke-width="3" marker-end="url(#arrowGreen)"/>
    <text x="530" y="995" fill="#10b981" font-size="11" font-family="system-ui, -apple-system, sans-serif">3. App sanitizes PHI in logs</text>

    <line x1="50" y1="1015" x2="100" y2="1015" stroke="#ec4899" stroke-width="3" marker-end="url(#arrowPink)"/>
    <text x="110" y="1020" fill="#ec4899" font-size="11" font-family="system-ui, -apple-system, sans-serif">4. Parameterized query</text>
    <line x1="250" y1="1015" x2="300" y2="1015" stroke="#f59e0b" stroke-width="3" marker-end="url(#arrowOrange)"/>
    <text x="310" y="1020" fill="#f59e0b" font-size="11" font-family="system-ui, -apple-system, sans-serif">5. Encrypt before storage</text>
    <line x1="450" y1="1015" x2="500" y2="1015" stroke="#06b6d4" stroke-width="3" marker-end="url(#arrowCyan)"/>
    <text x="510" y="1020" fill="#06b6d4" font-size="11" font-family="system-ui, -apple-system, sans-serif">6. Immutable audit log created</text>

    <!-- Error Scenario Flow -->
    <text x="50" y="1050" fill="#94a3b8" font-size="13" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Error Scenario Flow:</text>
    <line x1="50" y1="1065" x2="100" y2="1065" stroke="#ef4444" stroke-width="3" marker-end="url(#arrowRed)"/>
    <text x="110" y="1070" fill="#ef4444" font-size="11" font-family="system-ui, -apple-system, sans-serif">1. Database error occurs</text>
    <line x1="250" y1="1065" x2="300" y2="1065" stroke="#10b981" stroke-width="3" marker-end="url(#arrowGreen)"/>
    <text x="310" y="1070" fill="#10b981" font-size="11" font-family="system-ui, -apple-system, sans-serif">2. App catches, removes PHI</text>
    <line x1="470" y1="1065" x2="520" y2="1065" stroke="#8b5cf6" stroke-width="3" marker-end="url(#arrowPurple)"/>
    <text x="530" y="1070" fill="#8b5cf6" font-size="11" font-family="system-ui, -apple-system, sans-serif">3. Gateway sanitizes response</text>
    <line x1="700" y1="1065" x2="750" y2="1065" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrowBlue)"/>
    <text x="760" y="1070" fill="#3b82f6" font-size="11" font-family="system-ui, -apple-system, sans-serif">4. Generic error to client</text>
    <line x1="920" y1="1065" x2="970" y2="1065" stroke="#06b6d4" stroke-width="3" marker-end="url(#arrowCyan)"/>
    <text x="980" y="1070" fill="#06b6d4" font-size="11" font-family="system-ui, -apple-system, sans-serif">5. Full error logged securely</text>
  </g>

  <!-- Key Management Box -->
  <rect x="780" y="30" width="590" height="55" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="2"/>
  <text x="1075" y="52" text-anchor="middle" fill="#f59e0b" font-size="12" font-weight="bold" font-family="system-ui, -apple-system, sans-serif">Key Management &amp; Rotation</text>
  <text x="1075" y="70" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="system-ui, -apple-system, sans-serif">AWS KMS • Quarterly rotation • Separate keys per environment • Audit all key usage • Automated rotation pipeline</text>

</svg>