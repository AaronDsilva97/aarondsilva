---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3);

const formatRelativeDate = (date: Date) => {
  const now = new Date();
  const diffInDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));

  if (diffInDays === 0) return 'Today';
  if (diffInDays === 1) return 'Yesterday';
  if (diffInDays < 7) return `${diffInDays}d ago`;
  if (diffInDays < 30) return `${Math.floor(diffInDays / 7)}w ago`;
  return `${Math.floor(diffInDays / 30)}mo ago`;
};
---

<div class="h-full flex flex-col">
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center gap-2">
      <span class="text-lg">üìù</span>
      <h3 class="font-semibold text-slate-900 dark:text-white text-sm">Recent Posts</h3>
    </div>
    <a href="/blog" class="text-xs text-slate-500 dark:text-zinc-500 hover:text-purple-600 dark:hover:text-purple-400 transition-colors">
      View all ‚Üí
    </a>
  </div>

  <div class="flex-1 space-y-2">
    {posts.map((post) => (
      <a
        href={`/blog/${post.slug}`}
        class="block p-2 -mx-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5 transition-colors group"
      >
        <div class="flex items-start justify-between gap-3">
          <h4 class="text-sm text-slate-700 dark:text-zinc-200 group-hover:text-purple-600 dark:group-hover:text-purple-300 transition-colors line-clamp-1 flex-1">
            {post.data.title}
          </h4>
          <span class="text-xs text-slate-400 dark:text-zinc-600 whitespace-nowrap">
            {formatRelativeDate(post.data.publishDate)}
          </span>
        </div>
        <p class="text-xs text-slate-500 dark:text-zinc-500 mt-1 line-clamp-1">
          {post.data.description}
        </p>
      </a>
    ))}
  </div>
</div>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
